<div class="container-fluid">
  <% if @reviews.present? %>
    <table class="table reviews-table ml-2">
      <% @reviews.each do |review| %>
        <tr>
          <th>投稿者</th>
          <td class="text-center">
            <%= link_to user_path(review.user) do %>
              <%= attachment_image_tag review.user, :profile_image, :fill,65,65, fallback: "no_image.png", size: "65x65", class: "rounded-circle d-block mx-auto img-fluid" %>
            <% end %><br>
            <%= link_to review.user.name, user_path(review.user) %>
          </td>
          <th>評価</th>
          <td><div id="star-score-<%= review.id %>"></div> (<%= review.score %>点)</td>
          <th>タイトル</th>
          <td class="align-items-center"><%= review.title %></td>
          <th>レビュー本文</th>
          <td class="align-items-center"><%= review.body %></td>
        </tr>
      <% end %>
    </table>
    <%= paginate(@reviews) %>
  <% else %>
    <p class="ml-2">レビューはありません。</p>
  <% end %>
  <div class="review-error">
    <% if @review.errors.any? %>
      <%= @review.errors.count %>件のエラーが発生しました<br>
      <% @review.errors.full_messages.each do |message| %>
        ・<%= message %><br>
      <% end %>
    <% end %>
  </div>
  <!-- 口コミ入力フォーム -->
  <%= form_with(model:[@camp_site, @review], local: true) do |f| %>
    <!--キャンプサイトidの送信-->
    <%= f.hidden_field :camp_site_id, { value: @camp_site.id} %>
    <div class="star-form-group row col-12 col-sm-12 col-md-10 d-block">
      <%= f.label :score,'評価', class:'star-title col-md-3 col-form-label' %>
      <div class="star1 d-block ml-2">
        <%= f.hidden_field :score, id: :review_star, class: "col-md-9" %>
      </div>
    </div>

    <!-- 口コミ -->
    <div class="form-group row col-12 col-sm-12 col-md-10 d-block">
      <%= f.label :title, '件名 ', class:'col-md-3 col-form-label' %>
      <div class="col-md-9">
        <%= f.text_field :title, class: "form-control", rows: "8" %>
      </div>
    </div>
    <div class="form-group row col-12 col-sm-12 col-md-10 d-block">
      <%= f.label :body, '口コミ内容 ', class:'col-md-3 col-form-label' %>
      <div class="col-md-9">
        <%= f.text_area :body, class: "form-control", rows: "8", placeholder:'よかったこと、感想などレビューを書き込んでください' %>
      </div>
    </div>

    <!-- 投稿ボタン -->
    <div class="form-group row ml-2">
      <div class="col-md-9">
        <%= f.submit '投稿する', class:"btn btn-success d-block mt-3 mb-3" %>
      </div>
    </div>
  <% end %>
  <!--関連posts-->
  <h4 class="page-heading"><%= @camp_site.site_name %>に関する投稿</h4>
  <div class="row feeds-index">
    <%= render 'posts/feeds', posts: @posts %>
  </div>
</div>

<!-- 評価javascript -->
<script>
  $(document).on('turbolinks:load', function(){
    $('#star-score-<%= @review.id %>').raty({
      starOff:  '<%= asset_path('star-off.png') %>',
      starOn : '<%= asset_path('star-on.png') %>',
      starHalf: '<%= asset_path('star-half.png') %>',
      half: true,
      readOnly: true,
      score: <%= @review.score %>
    });
  });

$(document).on('turbolinks:load', function(){
  $('.star1').empty(); //星の表示をリセット（星の増加防止）
  $('.star1').raty({
    size: 36, //星のサイズ
    starOff:  '<%= asset_path('star-off.png') %>', //imagesフォルダから星画像を呼び出す（３種）
    starOn : '<%= asset_path('star-on.png') %>',
    starHalf: '<%= asset_path('star-half.png') %>',
    scoreName: 'review[score]',     //reviewモデルのscoreカラムに保存
    half: true               //星半分を許可する。DBには0.5単位の数値が保存される
  });
});

</script>